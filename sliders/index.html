<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />        
        <!-- CSS stylesheets -->
        <link rel="stylesheet" href="assets/css/styles.css" />
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/base/jquery-ui.css" />
        
        <!--[if lt IE 9]>
          <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
    
    <body>
        <section id="main">         
            <div id="slider"></div>
            <p class="note">Stars: <span id="currentValue">0</span></p>
            <div id="slider2"></div>
            <p class="note">HackerNews Upvotes: <span id="currentValue2">0</span></p>
        </section>
        <div align="center"><div id="chart_div" style="width: 900px; height: 500px;"></div></div>
        <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>
        <script src="assets/js/slider-jqueryui.js"></script>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("visualization", "1", {packages:["corechart"]});
            google.setOnLoadCallback(initialize);
            var data;
            var data2;
            var query;
            var stars_slider;
            var hn_pts_slider;
            function drawChart() {
                /*var data = google.visualization.arrayToDataTable([
                  ['Year', 'Sales'],
                  ['2004',  fk()],
                  ['2005',  1170],
                  ['2006',  660],
                  ['2007',  1030]
                ]);*/
                //alert("what");
                //var data = initialize();
                initialize(); 
                //var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                //chart.draw(data);
                //alert("end");
            }

            function fk() {
                //alert("fk");
                var currentValue = Number($('#currentValue').html(this.value));
                return Number(currentValue);
            }

            function initialize() {
                stars_slider = get_curr();
                hn_pts_slider = get_curr2();
                var opts = {sendMethod: 'auto'};
                
                /*var txt1 = 'select A, D where B = '; //B is stars, C is hn_pts
                txt1 = txt1 + stars_slider
                txt1 = txt1 + 'AND C = '
                txt1 = txt1 + hn_pts_slider*/
                query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1F6nHIvGWK7elk5ZzMlQy97z5DdtI-v7kkk_0CArqyI4/edit?usp=sharing', opts);
                q = 'select A, E where B = ' + stars_slider.toString() + ' AND C = ' + hn_pts_slider.toString() + ' AND G = 0';
                query.setQuery(q);
                query.send(handleQueryResponse1);

                
                //query.setQuery('select A, D where B = 10 AND C = 5 AND G = 1');
                //var d2 = query.send(handleQueryResponse);
                
                //var joinedData = google.visualization.data.join(d1, d2, 'full', [[0, 0]], [1], [1]);
                //var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                // chart.draw(joinedData, { legend: { position: 'none' }, colors: ['red', 'green'] });
            }

            function handleQueryResponse1(response) {
                if (response.isError()) {
                    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                    return;
                }
                data = response.getDataTable();
                q = 'select A, E where B = ' + stars_slider.toString() + ' AND C = ' + hn_pts_slider.toString() + ' AND G = 1';
                query.setQuery(q);
                query.send(handleQueryResponse2);
                //return data;
            }

            function handleQueryResponse2(response) {
                if (response.isError()) {
                    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                    return;
                }
                data2 = response.getDataTable();
                var joinedData = google.visualization.data.join(data, data2, 'full', [[0, 0]], [1], [1]);
                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(joinedData, { legend: { position: 'none' }, colors: ['red', 'green'] });
            }                          
    
        // Trigger the event on load, so
        // the value field is populated:
        
        //$('#defaultSlider').change();
        
        </script>
    
    </body>
</html>

